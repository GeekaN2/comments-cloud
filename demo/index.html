<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="style.css">
    <title>Comments test</title>
</head>
<body>
    <div id="app">
        <form action="addComment">
            <h2 class="text-center">Add comment</h2>
            <input type="text" class="nice-input" v-model="add_username" placeholder="Username">
            <input type="text" class="nice-input" v-model="add_text" placeholder="Some text">
            <div class="code-block">
                <h2 class="text-center">How your comment looks like</h2>
                <pre>
                    comment = {
                        _id: ObjectId(),
                        username: {{add_username || "\'\'"}},
                        text: {{add_text || "\'\'"}},
                        parent_id: null,
                        date: new Date(),
                        rating: 0
                    }
                </pre>
            </div>
            <input type="button" class="event" value="Add comment" v-on:click="add_comment">

            <h2 class="text-center">Get {{ limit || 'all' }} comments</h2>
            <input type="text" class="nice-input" v-model="limit" placeholder="Number of comments">
            <input type="button" class="event" value="Get comments" v-on:click="get_comments">


            <h2 class="text-center">Delete {{ delete_id }} comment</h2>
            <input type="text" class="nice-input" v-model="delete_id" placeholder="Comment id">
            <input type="button" class="event" value="Delete comment" v-on:click="delete_comment">

            <h2 class="text-center">Update {{ update_id }}</h2>
            <input type="text" class="nice-input" v-model="update_id" placeholder="Comment id">
            <input type="text" class="nice-input" v-model="update_text" placeholder="New text">
            <input type="text" class="nice-input" v-model="update_rating" placeholder="New rating">
            <input type="button" class="event" value="Update comment" v-on:click="update_comment">
        </form>
        
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.1/socket.io.js"></script>
    <script>
        
        const socket = io.connect('http://localhost:3000');

        var app = new Vue({
            el: '#app',
            data: {
                add_username: '',
                add_text: '',
                limit: '',
                delete_id: '',
                update_id: '',
                update_text: '',
                update_rating: '',
            },
            methods: {
                add_comment: function(){
                    socket.emit('req', {
                        type: "add",
                        data: {
                            username: this.add_username,
                            text: this.add_text,
                            parent_id: null
                        }
                    })
                },
                get_comments: function(){
                    socket.emit('req', {
                        type: "get",
                        data: { // some settings for the comments you want to receive (optionally)
                            limit: this.limit,
                            sort_by: { date: -1 },
                            fields: ['_id', 'username', 'text'] // comment fields you need (optionally)
                        },
                    })
                },
                delete_comment: function(){
                    socket.emit('req', {
                        type: "delete",
                        data: { 
                            _id: this.delete_id
                        },
                    })
                },
                update_comment: function(){
                    socket.emit('req', {
                        type: "update",
                        data: { 
                            _id: this.update_id,
                            text: this.update_text,
                            rating: Number(this.update_rating)
                        },
                    })
                },
                send_json: function(){
                    
                }
            },
        });

        socket.on('isAdded', function(data){
            console.log(data);
            if (data.isAdded){
                alert('Коммент добавлен: ' + data._id);
            } else
                alert('Коммент не добавлен: ', data);
        });

        socket.on('isGot', function(data){
            console.log(data);
            alert(JSON.stringify(data));
        })
        
        socket.on('isDeleted', function(data){
            console.log(data);
            if (data.isDeleted){
                alert('Коммент удалён');
            } else
                alert(data.err);
        })

        socket.on('isUpdated', function(data){
            console.log(data);
            if (data.isUpdated)
                alert('Коммент обновлён');
            else
                alert(data.err);
        })

    </script>
</body>
</html>